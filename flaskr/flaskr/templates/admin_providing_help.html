{% extends "layout.html" %}
{% block body %}
  
	<script type="text/javascript" src="{{ url_for('static', filename='js/jquery.idTabs.min.js') }}"></script>
  
	{% if error %}<p class=error><strong>Error:</strong> {{ error }}{% endif %}
  
	<div class="col-lg-12 text-center">	  
		<h3>提供帮助</h3>
	</div>
  
	<em>这里是一个tab选项卡，使用的是jquery idTabs（<a href='http://www.sunsean.com/idTabs/'>http://www.sunsean.com/idTabs/</a>），目前还没有为其设置样式</em>
	<ul class="idTabs"> 
	  <li><a href="#query">搜索</a></li> 
	  <li><a id='unmatched' href="#unmatched" onclick='my_fetch_unmatched()'>未匹配查询</a></li> 
	  <li><a href="#matched" onclick='my_fetch_matched()'>已匹配查询</a></li> 
	</ul> 
	
	<div id="query">
		<form id="" role="form" action="" method=post>
			{{ form.csrf_token }}
			{{ form.hidden_tag() }}
				
			<br />
			<div class="form-group">
				<!--{{ form.account.label }}-->
				{{ form.account(placeholder="请填写会员账号") }}
			</div>
			
			<br />
			<div class="form-group">
				<!-- {{ form.submit(class_='btn btn-lg btn-login btn-block-lg') }} -->
				<a onclick='my_query_by_account()'>提交</a>
			</div>
		</form>
		
		<table class="table table-striped table-bordered table-hover">
			<thead>
				<tr>
					<th style="text-align: center;">id</th>
					<th style="text-align: center;">账号</th>
					<th style="text-align: center;">用户姓名</th>
					<th style="text-align: center;">金额</th>
					<th style="text-align: center;">时间</th>
				</tr>
			</thead>
			<tbody id="query_result">		
				
			</tbody>
		</table>
	</div>
	<div id="unmatched">
		<table class="table table-striped table-bordered table-hover">
			<thead>
				<tr>
					<th style="text-align: center;">id</th>
					<th style="text-align: center;">账号</th>
					<th style="text-align: center;">用户姓名</th>
					<th style="text-align: center;">金额</th>
					<th style="text-align: center;">时间</th>
					<th style="text-align: center;">操作</th>
				</tr>
			</thead>
			<tbody id="unmatched_items">		
				
			</tbody>
		</table>
	</div> 
	<div id="matched">
		<table class="table table-striped table-bordered table-hover">
			<thead>
				<tr>
					<th style="text-align: center;">id</th>
					<th style="text-align: center;">账号</th>
					<th style="text-align: center;">用户姓名</th>
					<th style="text-align: center;">金额</th>
					<th style="text-align: center;">时间</th>
				</tr>
			</thead>
			<tbody id="matched_items">		
				
			</tbody>
		</table>
	</div>
  


<script type="text/javascript">
	var my_trying_to_match = function (item_id) {
		console.log('item_id', item_id);
	}
	
	var my_generate_html = function (jsonObj) {
		var info_list = '';
		$.each(jsonObj, function(index, content){ 
			//console.log( "item #" + index + " its value is: " + content ); 	
			
			info_list += ('<tr>' + 
								'<td>' + content.id + '</td>' +
								'<td>' + content.user + '</td>' +
								'<td>' + content.user_nc + '</td>' +
								'<td>' + content.jb + '</td>' +
								'<td>' + content.date + '</td>' +
						'</tr>');
		}); 
		console.log('info_list', info_list);
		return info_list;
	}
	var my_generate_html_with_operation = function (jsonObj) {
		var info_list = '';
		$.each(jsonObj, function(index, content){ 
			//console.log( "item #" + index + " its value is: " + content ); 	
			
			info_list += ('<tr>' + 
								'<td>' + content.id + '</td>' +
								'<td>' + content.user + '</td>' +
								'<td>' + content.user_nc + '</td>' +
								'<td>' + content.jb + '</td>' +
								'<td>' + content.date + '</td>' +
								'<td>' + '<a onclick="my_trying_to_match(' + content.id + ')">' + '手动匹配' + '</a>' + '</td>' +
						'</tr>');
		}); 
		console.log('info_list', info_list);
		return info_list;
	}
	var my_query_by_account = function () {
		$.post(
			'{{ url_for("admin_providing_help_query") }}', 	// Careful! Do not put wrong url here!
			{ account: $('#account').val() },     
			function (jsonObj, textStatus){        
				console.log(jsonObj);   
				var info_list = my_generate_html(jsonObj);
				$('#query_result').html(info_list);			// Careful! Do not put wrong id here!
			}, 
			"json"
		);
	}
	
	var my_fetch_unmatched = function () {
		$.post(
			'{{ url_for("admin_providing_help_unmatched_items") }}',  // Careful! Do not put wrong url here!
			{ },     
			function (jsonObj, textStatus){        
				console.log(jsonObj);   
				var info_list = my_generate_html_with_operation(jsonObj);
				$('#unmatched_items').html(info_list);			 	// Careful! Do not put wrong id here!
			}, 
			"json"
		);
	}
	
	var my_fetch_matched = function () {
		$.post(
			'{{ url_for("admin_providing_help_matched_items") }}', 	// Careful! Do not put wrong url here!
			{ },     
			function (jsonObj, textStatus){        
				console.log(jsonObj);   
				var info_list = my_generate_html(jsonObj);
				$('#matched_items').html(info_list);			 	// Careful! Do not put wrong id here!
			}, 
			"json"
		);
	}
	
	
	$(document).ready(function(){
		$('#unmatched').click();
	});
 </script>
 
{% endblock %}